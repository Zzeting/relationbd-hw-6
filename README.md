# Домашнее задание к занятию "`«Резервное копирование баз данных»`" - `Мамонтов Александр`


### Задание 1.

Кейс
Финансовая компания решила увеличить надёжность работы баз данных и их резервного копирования.

Необходимо описать, какие варианты резервного копирования подходят в случаях:

1.1. Необходимо восстанавливать данные в полном объёме за предыдущий день.

1.2. Необходимо восстанавливать данные за час до предполагаемой поломки.

1.3.* Возможен ли кейс, когда при поломке базы происходило моментальное переключение на работающую или починенную базу данных.


Решение:

1.1 - 1.2. Для обоих случаев идельно подойдет гибридный вариант дифференциального и инкрементального бэкапа. Дифференциальный бэкап содержит изменения в данных относительно полного бэкапа, инкрементальный — содержит изменения со времени последнего частичного бэкапа – последней инкрементальной копии. В начале каждого рабочего дня создаётся дифференциальный бэкап, и каждый час в течение рабочего времени — создание инкрементального бэкапа, тем самым мы получаем возможность восстанавилвать данные в полном объёме за предыдущий день и за час до предполагаемой поломки.

1.3. Правильно настроенная репликация позволить с неисправного мастера переключиться на исправный слейв, сделав его мастером. 

### Задание 2. 

2.1. С помощью официальной документации приведите пример команды резервирования данных и восстановления БД (pgdump/pgrestore).

    pg_dump <параметры> <имя базы> > <файл для сохранения копии> 
    (Пример: pg_dump -Fc postgres > "c:\backups\db.backup")

    pg_restore [параметр-подключения...] [параметр...] [имя_файла]
    (Пример: "createdb -T template0 newbase;" "pg_restore -d newbase "c:\backups\db.backup";")

2.1.* Возможно ли автоматизировать этот процесс? Если да, то как?

Возможно создание скрипта, в котором последовательно будет осуществляться подключение к БД и созданию ее копии. Далее прописать в планировщике выполнение данного скрипта по требуемому времени.


### Задание 3. 

3.1. С помощью официальной документации приведите пример команды инкрементного резервного копирования базы данных MySQL.

Для этого можно использовать утилиту `XtraBackup`.

    # xtrabackup --backup --user=root --password='R(zDXcVUmI[zwx%aNBTN' --target-dir=/root/backupdb/full

    # xtrabackup --backup --target-dir=/root/backupdb/inc1 --incremental-basedir=/root/backupdb/full



3.1.* В каких случаях использование реплики будет давать преимущество по сравнению с обычным резервным копированием?

В случаях, когда нельзя нарушать целостность БД, то есть БД должна работать на постоянной основе, таким образом, репликация позволит в непредвиденных случаях перенастроить мастера на слейв, при этом не останавливая работу БД. В то время как восстановление резервной копии займет определенное время.